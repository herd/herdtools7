AArch64 LB+ret-gcsb-dmb.sy+dmb.ld-gcsb
variant=shadowstack
{
SS(x,1);

0:GCSPR_EL1=x;
0:X3=y;
0:LR=label:"P0:L0";

1:X0=x;
1:X2=label:"P0:L0";
1:X3=y;
}
 P0                                      | P1                                      ;
 RET         (* GCS (Read) effect     *) | LDR W1,[X3]    (* Memory Read effect *) ;
 L0:                                     | DMB LD                                  ;
 GCSB DSYNC  (* GCSB effect           *) | GCSB DSYNC     (* GCSB effect        *) ;
 DMB SY                                  | GCSSTR X2,[X0] (* GCS (Write) effect *) ;
 MOV W2,#1                               |                                         ;
 STR W2,[X3] (* Memory (Write) effect *) |                                         ;
exists ~fault(P0,GCS:PRET) /\ 1:X1=1
