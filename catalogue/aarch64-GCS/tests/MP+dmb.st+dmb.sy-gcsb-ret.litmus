AArch64 MP+dmb.st+dmb.sy-gcsb-ret
variant=shadowstack,vmsa
{

uint64_t z=0;

SS(x,1);

[PTE(z)]=(oa:PA(x)); (* Alias z to x, otherwise STR would fault *)

0:X0=label:"P1:L0";
0:X2=y;
0:X4=z;

1:LR=label:"P1:L0";
1:X2=y;
1:GCSPR_EL1=x;


}

P0            | P1                                    ;
STR X0,[X4]   | LDR W1,[X2] (* Memory (Read) Effect *);
DMB ST        | DMB SY                                ;
MOV W1,#1     | GCSB DSYNC  (* GCSB Effect          *);
STR W1,[X2]   | RET         (* GCS (Read) Effect    *);
              | L0:                                   ;

exists 1:X1=1 /\ fault(P1,GCS:PRET)