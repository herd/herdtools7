%% Should be functional
\ifempty
\newcommand{\isempty}[1]{#1}
\ifformal\includecomment{emptyformal}\else\excludecomment{emptyformal}\fi
\iftodo\includecomment{emptytodo}\else\excludecomment{emptytodo}\fi
\else
\newcommand{\isempty}[1]{}
\excludecomment{emptyformal}
\excludecomment{emptytodo}
\fi
\ifformal
\includecomment{formal}
\else
\excludecomment{formal}
\fi
\iftodo
\includecomment{todo}
\else
\excludecomment{todo}
\fi
%%%Safety net
\iffalse
\makeatletter
\newcommand{\isempty}[1]{#1}
\newenvironment{formal}{\endgroup}{\begingroup\def\@currenvir{formal}}
\newenvironment{emptyformal}{\endgroup}{\begingroup\def\@currenvir{emptyformal}}
\newenvironment{emptytodo}{\endgroup}{\begingroup\def\@currenvir{emptytodo}}
\makeatother
\fi
